{
  "swagger": "2.0",
  "info": {
    "description": "API document",
    "version": "1.0",
    "title": "Chessi"
  },
  "host": "localhost:3000",
  "basePath": "/api/",
  "tags": [{
      "name": "Admin",
      "description": "System admin/management API"
    },
    {
      "name": "Logon",
      "description": "Logon related API. Used for both user and admin unless stated otherwise"
    },
    {
      "name": "User",
      "description": "User related API"
    },
    {
      "name": "Game",
      "description": "Game API"
    },
    {
      "name": "Discussion",
      "description": "Post and comment API"
    }
  ],
  "schemes": ["http"],
  "paths": {
    "/admin": {
      "put": {
        "tags": ["Admin"],
        "summary": "Create admin account",
        "consumes": ["application/json"],
        "produces": ["application/json"],
        "parameters": [{
            "name": "Authorization",
            "in": "header",
            "description": "Bearer token for authorization",
            "required": true,
            "type": "string",
            "default": "Bearer ADMIN_ACCESS_TOKEN_HERE"
          },
          {
            "name": "body",
            "in": "body",
            "required": "true",
            "schema": {
              "type": "object",
              "properties": {
                "username": {
                  "type": "string"
                },
                "password": {
                  "type": "string"
                }
              },
              "required": ["username", "password"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok",
                "msg": "Admin account created"
              }
            }
          },
          "401 1": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "You are not logged in"
              }
            }
          },
          "401 2": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Session expired. Please log in again"
              }
            }
          },
          "401 3": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Not admin"
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Username and/or email already used"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/admin/{adminid}": {
      "get": {
        "tags": ["Admin"],
        "summary": "Get admin account",
        "produces": ["application/json"],
        "parameters": [{
            "in": "path",
            "name": "adminid",
            "required": "true",
            "schema": {
              "type": "integer",
              "minimum": "1"
            },
            "description": "Admin id"
          },
          {
            "name": "Authorization",
            "in": "header",
            "description": "Bearer token for authorization",
            "required": true,
            "type": "string",
            "default": "Bearer ADMIN_ACCESS_TOKEN_HERE"
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok",
                "msg": "Done",
                "username": "something",
                "isAdmin": true
              }
            }
          },
          "401 1": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "You are not logged in"
              }
            }
          },
          "401 2": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Session expired. Please log in again"
              }
            }
          },
          "401 3": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Not admin"
              }
            }
          },
          "404": {
            "description": "Not found",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Cannot find admin"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      },
      "delete": {
        "tags": ["Admin"],
        "summary": "Remove admin account",
        "produces": ["application/json"],
        "parameters": [{
            "in": "path",
            "name": "adminid",
            "required": "true",
            "schema": {
              "type": "integer",
              "minimum": "1"
            },
            "description": "Admin id"
          },
          {
            "name": "Authorization",
            "in": "header",
            "description": "Bearer token for authorization",
            "required": true,
            "type": "string",
            "default": "Bearer ADMIN_ACCESS_TOKEN_HERE"
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok",
                "msg": "Done"
              }
            }
          },
          "401 1": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "You are not logged in"
              }
            }
          },
          "401 2": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Session expired. Please log in again"
              }
            }
          },
          "401 3": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Not admin"
              }
            }
          },
          "404": {
            "description": "Not found",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Cannot find admin"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/admin/all-user": {
      "get": {
        "tags": ["Admin"],
        "summary": "Get all users",
        "produces": ["application/json"],
        "parameters": [{
          "name": "Authorization",
          "in": "header",
          "description": "Bearer token for authorization",
          "required": true,
          "type": "string",
          "default": "Bearer ADMIN_ACCESS_TOKEN_HERE"
        }],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok",
                "msg": "Done",
                "user": [{
                    "userid": 1,
                    "username": "something",
                    "rating": 1500
                  },
                  {
                    "...": "same format"
                  }
                ]
              }
            }
          },
          "401 1": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "You are not logged in"
              }
            }
          },
          "401 2": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Session expired. Please log in again"
              }
            }
          },
          "401 3": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Not admin"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/admin/active-user": {
      "get": {
        "tags": ["Admin"],
        "summary": "Get all active users",
        "produces": ["application/json"],
        "parameters": [{
          "name": "Authorization",
          "in": "header",
          "description": "Bearer token for authorization",
          "required": true,
          "type": "string",
          "default": "Bearer ADMIN_ACCESS_TOKEN_HERE"
        }],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok",
                "msg": "Done",
                "user": [{
                    "userid": 1,
                    "username": "something",
                    "rating": 1500
                  },
                  {
                    "...": "same format"
                  }
                ]
              }
            }
          },
          "401 1": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "You are not logged in"
              }
            }
          },
          "401 2": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Session expired. Please log in again"
              }
            }
          },
          "401 3": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Not admin"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/admin/all-game": {
      "get": {
        "tags": ["Admin"],
        "summary": "Get all games",
        "produces": ["application/json"],
        "parameters": [{
          "name": "Authorization",
          "in": "header",
          "description": "Bearer token for authorization",
          "required": true,
          "type": "string",
          "default": "Bearer ADMIN_ACCESS_TOKEN_HERE"
        }],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok",
                "msg": "Done",
                "game": [{
                    "gameid": 17013687199650,
                    "reason": "Timed out",
                    "timestamp": "2023-11-30 18:26:03",
                    "finalFen": "rn1qkbnr/pppB1ppp/8/3p4/3P4/8/PPP2PPP/RNBQK1NR b KQkq - 0 5",
                    "white": "something",
                    "black": "something",
                    "whiteRatingChange": 7,
                    "blackRatingChange": -7
                  },
                  {
                    "...": "same format"
                  }
                ]
              }
            }
          },
          "401 1": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "You are not logged in"
              }
            }
          },
          "401 2": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Session expired. Please log in again"
              }
            }
          },
          "401 3": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Not admin"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/signup": {
      "post": {
        "tags": ["Logon"],
        "summary": "User signup",
        "consumes": ["application/json"],
        "produces": ["application/json"],
        "parameters": [{
          "name": "body",
          "in": "body",
          "required": "true",
          "schema": {
            "properties": {
              "data": {
                "type": "object",
                "properties": {
                  "username": {
                    "type": "string",
                    "description": "The username of the user"
                  },
                  "password": {
                    "type": "string",
                    "default": "Must include lowercase, uppercase, number and no other symbol. Min length 8"
                  },
                  "email": {
                    "type": "string",
                    "description": "The email of the user",
                    "default": "john@example.com"
                  }
                }
              }
            },
            "required": ["username", "password", "email"]
          }
        }],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok",
                "msg": "Head over to your mailbox for verification"
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Username Exist"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/login": {
      "post": {
        "tags": ["Logon"],
        "summary": "Login",
        "consumes": ["application/json"],
        "produces": ["application/json"],
        "parameters": [{
          "name": "body",
          "in": "body",
          "required": "true",
          "schema": {
            "properties": {
              "data": {
                "type": "object",
                "properties": {
                  "username": {
                    "type": "string",
                    "description": "The username of the user"
                  },
                  "password": {
                    "type": "string",
                    "default": "Must include lowercase, uppercase, number and no other symbol. Min length 8"
                  },
                  "socketid": {
                    "type": "string"
                  }
                }
              }
            },
            "required": ["username", "password", "socketid"]
          }
        }],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok",
                "msg": "Logged in",
                "accessToken": "JWT token",
                "sessionToken": "JWT token",
                "profile": {
                  "userid": 1,
                  "username": "something",
                  "isAdmin": false,
                  "rating": 1500
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Wrong credentials"
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Verify your email before continue"
              }
            }
          },
          "409": {
            "description": "Conflict",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "This account is logged in on another computer. Log out of the existing session then proceed to log in again"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/silent-login": {
      "post": {
        "tags": ["Logon"],
        "summary": "Login using session token",
        "produces": ["application/json"],
        "parameters": [
          {
            "name": "Authorization",
            "in": "header",
            "description": "Bearer token for session checking",
            "required": true,
            "type": "string",
            "default": "Bearer USER_SESSION_TOKEN_HERE"
          },
          {
            "name": "body",
            "in": "body",
            "required": "true",
            "schema": {
              "type": "object",
              "properties": {
                "socketid": {
                  "type": "string"
                }
              },
              "required": ["socketid"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok",
                "msg": "Logged in",
                "accessToken": "JWT token",
                "profile": {
                  "userid": 1,
                  "username": "something",
                  "isAdmin": false,
                  "rating": 1500
                }
              }
            }
          },
          "401 1": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "You are not logged in"
              }
            }
          },
          "401 2": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Session expired. Please log in again"
              }
            }
          },
          "401 3": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Cannot verify session"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/logout": {
      "post": {
        "tags": ["Logon"],
        "summary": "Logout",
        "produces": ["application/json"],
        "parameters": [
          {
            "name": "Authorization",
            "in": "header",
            "description": "Bearer token for authorization",
            "required": true,
            "type": "string",
            "default": "Bearer USER_ACCESS_TOKEN_HERE"
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok",
                "msg": "Logged out"
              }
            }
          },
          "401 1": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "You are not logged in"
              }
            }
          },
          "401 2": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Session expired. Please log in again"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/reset-password": {
      "post": {
        "tags": ["Logon"],
        "summary": "Reset password. A random password will be sent to the user via email",
        "produces": ["application/json"],
        "parameters": [{
          "name": "body",
          "in": "body",
          "required": "true",
          "schema": {
            "properties": {
              "data": {
                "type": "object",
                "properties": {
                  "username": {
                    "type": "string",
                    "description": "The username of the user"
                  },
                  "email": {
                    "type": "string",
                    "default": "john@example.com"
                  }
                }
              }
            },
            "required": ["username", "email"]
          }
        }],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok",
                "msg": "Head over to your mailbox to obtain new password"
              }
            }
          },
          "404": {
            "description": "Not found",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Cannot find user with given username/email"
              }
            }
          }
        }
      }
    },
    "/user/{userid}": {
      "get": {
        "tags": ["User"],
        "summary": "Get user account",
        "produces": ["application/json"],
        "parameters": [{
            "in": "path",
            "name": "userid",
            "required": "true",
            "schema": {
              "type": "integer",
              "minimum": "1"
            },
            "description": "User id"
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok",
                "msg": "Done",
                "username": "something",
                "rating": 1500, 
                "ratingChange": [
                  { "timestamp": "2023-11-30 18:26:03", "rating": 1493 },
                  { "...": "same format" }
                ],
                "gameHistory": [
                  {
                    "gameid": 17013687199650,
                    "reason": "Timed out",
                    "timestamp": "2023-11-30 18:26:03",
                    "finalFen": "rn1qkbnr/pppB1ppp/8/3p4/3P4/8/PPP2PPP/RNBQK1NR b KQkq - 0 5",
                    "white": "something",
                    "black": "something",
                    "whiteRatingChange": 7,
                    "blackRatingChange": -7
                  },
                  {
                    "...": "same format"
                  }
                ]
              }
            }
          },
          "404": {
            "description": "Not found",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Cannot find user"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/find-game": {
      "post": {
        "tags": ["Game"],
        "summary": "User find game",
        "produces": ["application/json"],
        "parameters": [{
          "name": "Authorization",
          "in": "header",
          "description": "Bearer token for authorization",
          "required": true,
          "type": "string",
          "default": "Bearer USER_ACCESS_TOKEN_HERE"
        }],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok"
              }
            }
          },
          "401 1": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "You are not logged in"
              }
            }
          },
          "401 2": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Session expired. Please log in again"
              }
            }
          },
          "401 3": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Cannot verify session"
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Cannot find game. Try again later"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      },
      "delete": {
        "tags": ["Game"],
        "summary": "User stop find game",
        "produces": ["application/json"],
        "parameters": [{
          "name": "Authorization",
          "in": "header",
          "description": "Bearer token for authorization",
          "required": true,
          "type": "string",
          "default": "Bearer USER_ACCESS_TOKEN_HERE"
        }],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok"
              }
            }
          },
          "401 1": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "You are not logged in"
              }
            }
          },
          "401 2": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Session expired. Please log in again"
              }
            }
          },
          "401 3": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Cannot verify session"
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Cannot find game. Try again later"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/game-info/{gameid}": {
      "get": {
        "tags": ["Game"],
        "summary": "Get game info",
        "produces": ["application/json"],
        "parameters": [{
            "in": "path",
            "name": "gameid",
            "required": "true",
            "schema": {
              "type": "integer",
              "minimum": "1"
            },
            "description": "Game id"
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok",
                "gameInfo": {
                  "gameid": 17028124918640,
                  "black": {
                    "username": "something",
                    "rating": 1465
                  },
                  "white": {
                    "username": "somgthing",
                    "rating": 1535
                  },
                  "position": "rnbqkbnr/ppp2ppp/8/3p4/3P4/8/PPP2PPP/RNBQKBNR w KQkq - 0 4",
                  "history": [
                    {
                      "color": "w",
                      "piece": "p",
                      "from": "e2",
                      "to": "e4",
                      "san": "e4",
                      "flags": "b",
                      "lan": "e2e4",
                      "before": "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
                      "after": "rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq - 0 1"
                    },
                    {
                      "...": "same format"
                    }
                  ],
                  "turn": "w",
                  "timeLeft": 897
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Cannot find game"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/user-active-game": {
      "get": {
        "tags": ["Game"],
        "summary": "Get user's current active game",
        "produces": ["application/json"],
        "parameters": [
          {
            "name": "Authorization",
            "in": "header",
            "description": "Bearer token for authorization",
            "required": true,
            "type": "string",
            "default": "Bearer USER_ACCESS_TOKEN_HERE"
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "examples": {
              "application/json": {
                "status": "ok",
                "inGame": true,
                "gameid": 17013687199650
              }
            }
          },
          "401 1": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "You are not logged in"
              }
            }
          },
          "401 2": {
            "description": "Unauthorized",
            "examples": {
              "application/json": {
                "status": "error",
                "msg": "Session expired. Please log in again"
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    }
  }
}